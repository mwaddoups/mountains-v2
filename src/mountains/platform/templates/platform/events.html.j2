{% from "platform/_profile.html.j2" import profile_picture, badge %}
{% extends "platform/base.html.j2" %}
{% block platform %}
  {% if g.current_user.is_site_admin %}
    <a href="{{ url_for('platform.edit_event') }}" class="button">Create Event</a>
  {% endif %}
  <form>
    <input type="search" name="search" placeholder="Search for an event..." />
    <label>
      Event Types
      <select multiple name="types">
        <option>TODO</option>
      </select>
    </label>
  </form>
  <section>
    {% for event in events %}
      <article id="{{ event.id }}" class="event">
        <header>
          <div class="event-date">
            <p>{{ event.event_dt.strftime("%A") }}</p>
            <h1>{{ event.event_dt.strftime("%d") }}</h1>
            <p>{{ event.event_dt.strftime("%b %Y") }}</p>
          </div>
          <div>
            <h1>{{ event.title }}</h1>
            {{ badge(event.event_type.name) }}
            {% if event.is_members_only %}{{ badge("Members Only") }}{% endif %}
          </div>
        </header>
        <div class="event-description">{{ event.description | markdown | safe }}</div>
        {% if attendees[event.id] and ((attendees[event.id] | length) > 0) %}
          <ul>
            {% for attendee in attendees[event.id] %}
              {% set user = members[attendee.user_id] %}
              <li>{{ user.full_name }}</li>
            {% endfor %}
          </ul>
        {% else %}
          <em>No attendees yet!</em>
        {% endif %}
      </article>
    {% endfor %}
  </section>
{% endblock platform %}
