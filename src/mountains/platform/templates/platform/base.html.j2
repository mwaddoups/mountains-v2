{% extends "base.html.j2" %}
{% from 'macros/bi.html.j2' import bi_list %}
{% macro nav_link(endpoint, name, class="") %}
  {% set target_url = url_for(endpoint, **kwargs) %}
  <li class="{{ class }}">
    {% if caller %}
      {# Top level should show as selected #}
      {% set is_selected = request.path.startswith(target_url) %}
    {% else %}
      {% set is_selected = request.path == target_url %}
    {% endif %}
    <a href="{{ target_url }}"
       aria-selected="{{ 'true' if is_selected else 'false' }}">{{ name }}</a>
    {% if caller %}{{ caller() }}{% endif %}
  </li>
{% endmacro %}
{% block sidebar %}
  <nav id="sidebar-nav" data-expanded="false">
    <ul preload>
      {% call nav_link('platform.home', 'Club Info') %}
        <ul>
          {{ nav_link('platform.home', 'Overview') }}
          {{ nav_link('platform.home', 'Day Walks', page='day-walks') }}
          {{ nav_link('platform.home', 'Hut Trips', page='hut-weekends') }}
          {{ nav_link('platform.home', 'Climbing', page='climbing') }}
          {{ nav_link('platform.home', 'Trail Running', page='running') }}
        </ul>
      {% endcall %}
      {% call nav_link('platform.events.events', 'Events') %}
        <ul>
          {{ nav_link('platform.events.events', 'Upcoming') }}
          {{ nav_link('platform.events.events_calendar', 'Calendar') }}
        </ul>
      {% endcall %}
      {{ nav_link('platform.members.members', 'Members') }}
      {{ nav_link('platform.albums.albums', 'Photos') }}
      {{ nav_link('platform.join', 'Join the Club') }}
      <li>
        <a href="https://discord.gg/98K3CafRxk">Discord</a>
      </li>
      <li>
        <a href="https://www.tshirtstudio.com/marketplace/clyde-mountaineering-club">Club Merch</a>
      </li>
      {% if g.current_user.is_site_admin %}
        {% call nav_link('platform.committee.overview', 'Committee', class="admin") %}
          <ul>
            {{ nav_link('platform.committee.overview', 'Overview') }}
            {{ nav_link('platform.committee.treasurer', 'Treasurer') }}
            {{ nav_link('platform.committee.page_editor', 'Pages') }}
          </ul>
        {% endcall %}
      {% endif %}
    </ul>
    <button id="sidebar-hamburger"
            onclick="document.getElementById('sidebar-nav').dataset.expanded = document.getElementById('sidebar-nav').dataset.expanded === 'true' ? 'false' : 'true' ">
      {{ bi_list() }}
    </button>
  </nav>
{% endblock sidebar %}
