{% extends "platform/base.html.j2" %}
{% block platform %}
  <header>
    <a href="{{ url_for('.albums') }}">< Back to Photos</a>
  </header>
  <details>
    <summary>Upload Photos</summary>
    <form id="upload"
          method="post"
          enctype="multipart/form-data"
          action="{{ url_for('.album', id=album.id) }}"
          hx-post="{{ url_for('.album', id=album.id) }}"
          hx-select="#upload">
      <input type="file" name="photos" accept='image/*' multiple />
      <input type="submit" value="Upload" />
      <progress id="progress" value="0" max="100"></progress>
    </form>
    <script>
        htmx.on('#upload', 'htmx:xhr:progress', function(evt) {
          htmx.find('#progress').setAttribute('value', evt.detail.loaded/evt.detail.total * 100)
        });
    </script>
  </details>
  <section id="gallery" hx-target="#highlighted">
    <dialog id="highlighted">
      {% if highlighted_ix != None %}
        {% include "platform/album._highlighted.html.j2" %}
      {% endif %}
    </dialog>
    <script>
      const openDialog = () => {
        const dialog = document.getElementById('highlighted');
        if (dialog.hasChildNodes() && (!dialog.open)) {
          dialog.showModal();
        } else {
          dialog.close()
        }
      }
      htmx.on('#gallery', 'htmx:afterSettle', function(evt) {
        openDialog();
      });
    </script>
    {# hide duplicate attribute and image width/height/alt warnings #}
    {# djlint:off H006,H037,H013 #}
    {% for photo in photos %}
      <a hx-boost="true"
         hx-on::afterRequest="openDialog()"
         href="{{ url_for('.album', id=album.id, highlighted_id=photo.id) }}">
        <img height="160"
             src="{{ url_for('static', filename=photo.photo_path) }}"
             loading="lazy"
             data-starred="{{ 'true' if photo.starred else 'false' }}" />
      </a>
    {% endfor %}
  </section>
{% endblock platform %}
