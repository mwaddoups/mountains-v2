{% from "macros/theme.html.j2" import badge, color_class %}
{% from "macros/profile.html.j2" import profile_picture %}
<article id="{{ event.slug }}"
         hx-target="this"
         hx-indicator="this"
         hx-swap="outerHTML show:top swap:0.5s settle:0.5s"
         class="event card{{ ' event-past' if not event.is_upcoming() }}">
  {% if request.args.pay_success %}<p role="status">Payment successful! Thank you :)</p>{% endif %}
  {% if request.args.pay_cancel %}<p role="alert">Payment was cancelled!</p>{% endif %}
  <header class="flex">
    <div class="event-date">
      <span>{{ event.event_dt.strftime("%A") }}</span>
      <span>{{ event.event_dt.strftime("%-d") }}</span>
      <span>{{ event.event_dt.strftime("%b %Y") }}</span>
    </div>
    <div>
      <span class="flex">
        <h1>
          <a hx-disable="true" href="{{ url_for('.event', id=event.id) }}">{{ event.title }}</a>
        </h1>
      </span>
      {{ badge(event.event_type.name) }}
      {% if event.is_members_only %}{{ badge("Members Only") }}{% endif %}
      {% if event.event_end_dt %}
        <p>
          {{ event.event_dt.strftime("%A, %b %d, %Y, %H:%M") }} ðŸ¡ª {{ event.event_end_dt.strftime("%A, %b %d, %Y, %H:%M") }}
        </p>
      {% else %}
        <p>&nbsp;{{ event.event_dt.strftime("%A, %b %d, %Y, %H:%M") }}</p>
      {% endif %}
    </div>
    {% if g.current_user.is_site_admin %}
      <details class="admin">
        <summary>Admin</summary>
        <article class="admin-panel">
          <a class="button" href="{{ url_for('.edit_event', id=event.id) }}">Edit event</a>
          <a class="button"
             href="{{ url_for('.edit_event', copy_from=event.id) }}">Copy event</a>
          <form method="post"
                hx-post="{{ url_for('.event', id=event.id) }}"
                hx-swap="delete swap:0.5s settle:0.5s"
                action="{{ url_for('.event', id=event.id) }}">
            <input type="hidden" name="method" value="DELETE" />
            <input type="submit" value="Delete event" />
          </form>
        </article>
      </details>
    {% endif %}
  </header>
  {# Tiny bit of javascript to handle expansion of the description #}
  <section class="event-description {{ color_class(event.event_type.name) }}"
           data-expanded="false"
           onclick="this.dataset.expanded = (this.dataset.expanded === 'false' ? 'true' : 'false') ">
    {{ event.description | markdown | safe }}
  </section>
  <section class="event-all-attendees">
    {% include "events/event._attendees.html.j2" %}
  </section>
</article>
